{"version":3,"sources":["../../src/components/monasca_client.js"],"names":["config","appEvents","MonascaClient","datasourceSrv","name","bootData","user","_get","then","resp","data","elements","map","e","dimension_name","catch","err","params","dimension_value","dimensions","metric_dimensions","d","key","value","join","id","_delete","group_by","alarm_definition","_post","actions_enabled","patchAlarmDefinition","_patch","element","type","notification","path","_request","get","method","_getDataSource","headers","data_source","token","options","url","withCredentials","backendSrv","datasourceRequest","status","monasca_response","message","description","err_name","Object","keys"],"mappings":"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","file":"monasca_client.js","sourcesContent":["/*\n *   Copyright 2017 StackHPC\n *\n *   Licensed under the Apache License, Version 2.0 (the \"License\");\n *   you may not use this file except in compliance with the License.\n *   You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n *   Unless required by applicable law or agreed to in writing, software\n *   distributed under the License is distributed on an \"AS IS\" BASIS,\n *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *   See the License for the specific language governing permissions and\n *   limitations under the License.\n */\n\nimport config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\n\nexport default class MonascaClient {\n\n  constructor(datasourceSrv) {\n    this.name = config.bootData.user.name;\n    this.datasourceSrv = datasourceSrv;\n  }\n\n  // Dimensions\n\n  listDimensionNames() {\n    return this._get('/v2.0/metrics/dimensions/names')\n      .then(resp => resp.data.elements.map(e => e.dimension_name))\n      .catch(err => { throw err; });\n  }\n\n  listDimensionValues(dimension_name) {\n    var params = {\n      dimension_name: dimension_name\n    };\n    return this._get('/v2.0/metrics/dimensions/names/values', params)\n      .then(resp => resp.data.elements.map(e => e.dimension_value))\n      .catch(err => { throw err; });\n  }\n\n  \n  // Alarms\n  \n  listAlarms(dimensions) {\n    var params = {};\n    if (dimensions) {\n      params.metric_dimensions =\n\tdimensions\n\t.map(d => d.key + ':' + d.value)\n\t.join(',');\n    }\n    return this._get('/v2.0/alarms/', params)\n      .then(resp => resp.data.elements)\n      .catch(err => { throw err; });\n  }\n\n  deleteAlarm(id) {\n    return this._delete('/v2.0/alarms/' + id)\n      .then(resp => null)\n      .catch(err => { throw err; });\n  }\n\n  countAlarms(group_by) {\n    return this._get('/v2.0/alarms/count/', { group_by: group_by })\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n  \n  // Alarm Definitions\n  \n  listAlarmDefinitions() {\n    return this._get('/v2.0/alarm-definitions/')\n      .then(resp => resp.data.elements)\n      .catch(err => { throw err; });\n  }\n\n  getAlarmDefinition(id) {\n    return this._get('/v2.0/alarm-definitions/' + id)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n  \n  createAlarmDefinition(alarm_definition) {\n    return this._post('/v2.0/alarm-definitions/', alarm_definition)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n\n  enableAlarmDefinition(id, actions_enabled) {\n    return this.patchAlarmDefinition(id, { actions_enabled: !!actions_enabled });\n  }\n\n  patchAlarmDefinition(id, alarm_definition) {\n    return this._patch('/v2.0/alarm-definitions/' + id, alarm_definition)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n  \n  deleteAlarmDefinition(id) {\n    return this._delete('/v2.0/alarm-definitions/' + id)\n      .then(resp => null)\n      .catch(err => { throw err; });\n  }\n\n  // Notification Method Types\n  \n  listNotificationTypes() {\n    return this._get('/v2.0/notification-methods/types/')\n      .then(resp => resp.data.elements.map(element => element.type))\n      .catch(err => { throw err; });\n  }\n\n  // Notification Methods\n  \n  listNotifications() {\n    return this._get('/v2.0/notification-methods/')\n      .then(resp => resp.data.elements)\n      .catch(err => { throw err; });\n  }\n\n  getNotification(id) {\n    return this._get('/v2.0/notification-methods/' + id)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });    \n  }\n\n  patchNotification(id, notification) {\n    return this._patch('/v2.0/notification-methods/'+ id, notification)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n\n  createNotification(notification) {\n    return this._post('/v2.0/notification-methods/', notification)\n      .then(resp => resp.data)\n      .catch(err => { throw err; });\n  }\n  \n  deleteNotification(id) {\n    return this._delete('/v2.0/notification-methods/' + id)\n      .then(resp => null)\n      .catch(err => { throw err; });\n  }\n\n  \n  _delete(path, params) {\n    return this._request('DELETE', path, params, null);\n  };\n  \n  _get(path, params) {\n    return this._request('GET', path, params, null);\n  };\n\n  _post(path, data) {\n    return this._request('POST', path, null, data);\n  };\n\n  _patch(path, data) {\n    return this._request('PATCH', path, null, data);\n  };\n\n  _getDataSource() {\n    return this.datasourceSrv.get('Monasca');\n  }\n  \n  _request(method, path, params, data) {\n    return this._getDataSource().then(data_source => {\n      \n      var headers = {\n\t'Content-Type': 'application/json',\n\t'X-Auth-Token': data_source.token\n      };\n\n      var options = {\n\tmethod: method,\n\turl:    data_source.url + path,\n\tparams: params,\n\tdata: data,\n\theaders: headers,\n\twithCredentials: true,\n      };\n\n      return data_source.backendSrv.datasourceRequest(options).catch(err => {\n\tif (err.status !== 0 || err.status >= 300) {\n          var monasca_response;\n          if (err.data) {\n            if (err.data.message){\n              monasca_response = err.data.message;\n\t    }\n\t    else if (err.data.description) {\n\t      monasca_response = err.data.description;\n\t    } else{\n              var err_name = Object.keys(err.data)[0];\n              monasca_response = err.data[err_name].message;\n            }\n          }\n          if (monasca_response) {\n            throw { message: 'Monasca Error Response: ' + monasca_response };\n          } else {\n            throw { message: 'Monasca Error Status: ' + err.status };\n          }\n\t}\n      });\n    }).catch(err => { throw err; });\n  };\n\n  \n}\n\n"]}