{"version":3,"sources":["../../src/components/alarm_history.js"],"names":["config","appEvents","MonascaClient","AlarmHistoryPageCtrl","$scope","$injector","$location","backendSrv","datasourceSrv","alertSrv","monasca","updating","updateFailed","id","search","states","savedAlarm","saving","deleting","loadAlarm","loadStates","alarm","name","alarm_definition","severity","state","_this","getAlarm","then","pickKnownFields","catch","set","err","message","loadFailed","pageLoaded","temp","getAlarmHistory","alarm_history","i","elements","length","timestamp","replace","push","templateUrl"],"mappings":"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","file":"alarm_history.js","sourcesContent":["/*\n *   (C) Copyright 2017 Hewlett Packard Enterprise Development LP\n *\n *   Licensed under the Apache License, Version 2.0 (the \"License\");\n *   you may not use this file except in compliance with the License.\n *   You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n *   Unless required by applicable law or agreed to in writing, software\n *   distributed under the License is distributed on an \"AS IS\" BASIS,\n *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *   See the License for the specific language governing permissions and\n *   limitations under the License.\n */\n\nimport config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\nimport MonascaClient from './monasca_client';\n\nexport class AlarmHistoryPageCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, backendSrv, datasourceSrv, alertSrv) {\n\n    this.$location = $location;\n    this.alertSrv = alertSrv\n    this.monasca = new MonascaClient(backendSrv, datasourceSrv);\n    this.updating = true;\n    this.updateFailed = false;\n\n    this.id = null;\n    if('id' in this.$location.search()){\n      this.id = this.$location.search().id;\n    }\n\n    this.states = [];\n    this.savedAlarm = {};\n    this.saving = false;\n    this.deleting = false;\n    this.savedAlarm = this.loadAlarm();\n    this.states = this.loadStates();\n\n  }\n\n  pickKnownFields(alarm){\n    this.savedAlarm.name = alarm.alarm_definition.name;\n    this.savedAlarm.severity = alarm.alarm_definition.severity;\n    this.savedAlarm.state = alarm.state;\n    return this.savedAlarm;\n\n  }\n\n  loadAlarm(){\n    var _this = this;\n    if(!this.id){\n      this.updating = false;\n      return;\n    }\n\n    this.monasca.getAlarm(this.id).then(function (alarm) {\n      _this.savedAlarm = _this.pickKnownFields(alarm);\n    }).catch(err => {\n      _this.alertSrv.set(\"Failed to fetch alarm method.\", err.message,\n      'error', 10000);\n      _this.loadFailed = true;\n    }).then(() => {\n      _this.pageLoaded = true;\n    });\n    return this.savedAlarm;\n\n  }\n\n  loadStates(){\n    if(!this.id){\n      this.updating = false;\n      return;\n    }\n\n    var temp = [];\n    this.monasca.getAlarmHistory(this.id).then(function (alarm_history) {\n      for (var i = 0; i < alarm_history.elements.length; i++){\n        alarm_history.elements[i].timestamp =\n          alarm_history.elements[i].timestamp.replace(/[A-Z.]/g, ' ');\n        alarm_history.elements[i].timestamp =\n          alarm_history.elements[i].timestamp.replace(/.{4}$/g, ' ');\n          temp.push(alarm_history.elements[i]);\n      }\n    }).catch(err => {\n      this.alertSrv.set(\"Failed to fetch alarm history method.\", err.message,\n      'error', 10000);\n      this.loadFailed = true;\n    }).then(() => {\n      this.pageLoaded = true;\n    });\n    return temp;\n\n  }\n}\n\n\nAlarmHistoryPageCtrl.templateUrl = 'components/alarm_history.html';\n"]}