{"version":3,"sources":["../../src/components/alarm_definitions.js"],"names":["config","appEvents","MonascaClient","AlarmDefinitionsPageCtrl","$scope","$injector","$location","$q","backendSrv","datasourceSrv","contextSrv","alertSrv","name","bootData","user","isOrgEditor","monasca","pageLoaded","loadFailed","alarm_definitions","loadAlarmDefinitions","listAlarmDefinitions","then","catch","set","err","message","id","actions_enabled","index","findIndex","n","deleting","find","splice","enabling","setAlarmDefinitionEnabling","enableAlarmDefinition","setAlarmDefinitionActionsEnabled","alarm_definition","confirmEnableAlarmDefinition","setAlarmDefinitionDeleting","deleteAlarmDefinition","alarmDefinitionDeleted","definition","emit","title","text","text2","yesText","icon","onConfirm","confirmDeleteAlarmDefinition","templateUrl"],"mappings":"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","file":"alarm_definitions.js","sourcesContent":["import config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\nimport MonascaClient from './monasca_client';\n\nexport class AlarmDefinitionsPageCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, datasourceSrv, contextSrv, alertSrv) {\n    this.name = config.bootData.user.name;\n    //this.isOrgEditor = contextSrv.hasRole('Editor') || contextSrv.hasRole('Admin');\n    this.isOrgEditor = true;\n    this.alertSrv = alertSrv;\n    this.monasca = new MonascaClient(datasourceSrv);\n    this.pageLoaded = false;\n    this.loadFailed = false;\n    this.alarm_definitions = [];\n    this.loadAlarmDefinitions();\n  }\n  \n  loadAlarmDefinitions() {\n    this.monasca.listAlarmDefinitions().then(alarm_definitions => {\n      this.alarm_definitions = alarm_definitions;\n    }).catch(err => {\n      this.alertSrv.set(\"Failed to get fetch alarm definitions.\", err.message, 'error', 10000);\n      this.loadFailed = true;\n    }).then(() => {\n      this.pageLoaded = true;\n    });\n  }\n\n  setAlarmDefinitionActionsEnabled(id, actions_enabled) {\n    var index = this.alarm_definitions.findIndex(n => n.id === id);\n    if (index !== -1) {\n      this.alarm_definitions[index].actions_enabled = actions_enabled;\n    }\n  }\n\n  setAlarmDefinitionDeleting(id, deleting) {\n    var index = this.alarm_definitions.findIndex(n => n.id === id);\n    if (index !== -1) {\n      this.alarm_definitions[index].deleting = deleting;\n    }\n  }\n\n  alarmDefinitionDeleted(id) {\n    var index = this.alarm_definitions.find(n => n.id === id);\n    if (index !== -1) {\n      this.alarm_definitions.splice(index, 1);\n    }\n  }\n  \n  setAlarmDefinitionEnabling(id, enabling) {\n    var index = this.alarm_definitions.findIndex(n => n.id === id);\n    if (index !== -1) {\n      this.alarm_definitions[index].enabling = enabling;\n    }\n  }\n  \n  confirmEnableAlarmDefinition(id, actions_enabled) {\n    this.setAlarmDefinitionEnabling(id, true);\n    \n    this.monasca.enableAlarmDefinition(id, actions_enabled).then(alarm_definition => {\n      this.setAlarmDefinitionActionsEnabled(id, alarm_definition.actions_enabled);\n    }).catch(err => {\n      this.alertSrv.set(\"Failed to enable or disable alarm definition.\", err.message, 'error', 10000);\n    }).then(() => {\n      this.setAlarmDefinitionEnabling(id, false);\n    });\n\n  }\n\n  enableAlarmDefinition(alarm_definition, actions_enabled) {\n    this.confirmEnableAlarmDefinition(alarm_definition.id, actions_enabled);\n  }\n\n  confirmDeleteAlarmDefinition(id) {\n    this.setAlarmDefinitionDeleting(id, true);\n    \n    this.monasca.deleteAlarmDefinition(id).then(() => {\n      this.alarmDefinitionDeleted(id);\n    }).catch(err => {\n      this.setAlarmDefinitionDeleting(id, false);\n      this.alertSrv.set(\"Failed to delete alarm definition.\", err.message, 'error', 10000);\n    });\n  }\n\n  deleteAlarmDefinition(definition) {\n    appEvents.emit('confirm-modal', {\n      title: 'Delete',\n      text: 'Are you sure you want to delete this alarm definition?',\n      text2: definition.name,\n      yesText: \"Delete\",\n      icon: \"fa-trash\",\n      onConfirm: () => {\n        this.confirmDeleteAlarmDefinition(definition.id);\n      }\n    });\n  }\n  \n}\nAlarmDefinitionsPageCtrl.templateUrl = 'components/alarm_definitions.html';\n"]}